from enum import IntEnum
from typing import Optional

from pydantic import BaseModel

from py_ocsf_models.events.findings.severity_id import SeverityID
from py_ocsf_models.objects.cve import CVE


class MalwareClassificationID(IntEnum):
    """
    The normalized identifiers for malware categories.

    0 Unknown: The classification is unknown.
    1 Adware: Adware.
    2 Backdoor: Backdoor.
    3 Bot: Bot.
    4 Bootkit: Bootkit.
    5 DDOS: Distributed Denial of Service.
    6 Downloader: Downloader.
    7 Dropper: Dropper.
    8 ExploitKit: Exploit Kit.
    9 Keylogger: Keylogger.
    10 Ransomware: Ransomware.
    11 RemoteAccessTrojan: Remote Access Trojan (RAT).
    13 ResourceExploitation: Resource Exploitation (e.g., cryptominer).
    14 RogueSecuritySoftware: Rogue Security Software.
    15 Rootkit: Rootkit.
    16 ScreenCapture: Screen Capture.
    17 Spyware: Spyware.
    18 Trojan: Trojan.
    19 Virus: Virus.
    20 Webshell: Webshell.
    21 Wiper: Wiper.
    22 Worm: Worm.
    99 Other: The classification is not mapped. See the classifications attribute.
    """

    Unknown = 0
    Adware = 1
    Backdoor = 2
    Bot = 3
    Bootkit = 4
    DDOS = 5
    Downloader = 6
    Dropper = 7
    ExploitKit = 8
    Keylogger = 9
    Ransomware = 10
    RemoteAccessTrojan = 11
    # Note: 12 is intentionally skipped in the OCSF schema
    ResourceExploitation = 13
    RogueSecuritySoftware = 14
    Rootkit = 15
    ScreenCapture = 16
    Spyware = 17
    Trojan = 18
    Virus = 19
    Webshell = 20
    Wiper = 21
    Worm = 22
    Other = 99


class Malware(BaseModel):
    """
    The Malware object describes characteristics of malware.

    Constraint: At least one of name, uid must be present.

    Attributes:
    - Classification IDs (classification_ids) [Required]: The normalized malware classification identifiers.
    - Classifications (classifications) [Optional]: The malware classifications as reported by the source.
    - CVEs (cves) [Optional]: The CVEs associated with this malware.
    - Name (name) [Recommended]: The name of the malware.
    - Provider (provider) [Recommended]: The provider of the malware information.
    - Severity (severity) [Optional]: The severity as a string.
    - Severity ID (severity_id) [Recommended]: The normalized severity identifier.
    - UID (uid) [Recommended]: The unique identifier of the malware.
    """

    classification_ids: list[MalwareClassificationID]
    classifications: Optional[list[str]] = None
    cves: Optional[list[CVE]] = None
    name: Optional[str] = None
    provider: Optional[str] = None
    severity: Optional[str] = None
    severity_id: Optional[SeverityID] = None
    uid: Optional[str] = None
